CREATE TABLE [dbo].[tblPrestamos] (
    [IdPrestamo]                   INT             IDENTITY (1, 1) NOT NULL,
    [idNegocio]                    INT             NOT NULL,
    [idLocalidadNegocio]           INT             NOT NULL,
    [idCliente]                    INT             NOT NULL,
    [prestamoNumero]               VARCHAR (20)    NOT NULL,
    [IdPrestamoARenovar]           INT             NULL,
    [DeudaRenovacion]              DECIMAL (14, 2) DEFAULT ((0)) NULL,
    [idClasificacion]              INT             NOT NULL,
    [IdTipoAmortizacion]           INT             NOT NULL,
    [FechaEmisionReal]             DATE            NOT NULL,
    [FechaEmisionParaCalculo]      DATE            NOT NULL,
    [FechaVencimiento]             DATE            NOT NULL,
    [IdTasaInteres]                INT             NOT NULL,
    [idTipoMora]                   INT             NOT NULL,
    [idPeriodo]                    INT             NOT NULL,
    [CantidadDePeriodos]           INT             NOT NULL,
    [MontoPrestado]                DECIMAL (14, 2) DEFAULT ((0)) NOT NULL,
    [TotalPrestado]                AS              ([MontoPrestado]+[DeudaRenovacion]) PERSISTED,
    [IdDivisa]                     INT             DEFAULT ((1)) NOT NULL,
    [InteresGastoDeCierre]         DECIMAL (6, 2)  NOT NULL,
    [MontoGastoDeCierre]           DECIMAL (14, 2) NOT NULL,
    [GastoDeCierreEsDeducible]     BIT             NOT NULL,
    [CargarInteresAlGastoDeCierre] BIT             NOT NULL,
    [FinanciarGastoDeCierre]       BIT             DEFAULT ((0)) NOT NULL,
    [OtrosCargosSinInteres]        BIT             DEFAULT ((0)) NOT NULL,
    [AcomodarFechaALasCuotas]      BIT             DEFAULT ((0)) NOT NULL,
    [FechaInicioPrimeraCuota]      DATETIME        NOT NULL,
    [InsertadoPor]                 VARCHAR (100)   NOT NULL,
    [FechaInsertado]               DATETIME        DEFAULT (getdate()) NOT NULL,
    [ModificadoPor]                VARCHAR (100)   NULL,
    [FechaModificado]              DATETIME        NULL,
    [BorradoPor]                   VARCHAR (100)   NULL,
    [FechaBorrado]                 DATETIME        NULL,
    [Saldado]                      BIT             DEFAULT ((0)) NOT NULL,
    PRIMARY KEY CLUSTERED ([IdPrestamo] ASC),
    CHECK ([CantidadDePeriodos]>(0)),
    CONSTRAINT [TotalCapitalMayorQueCero] CHECK ([TotalPrestado]>(0)),
    FOREIGN KEY ([idClasificacion]) REFERENCES [dbo].[tblClasificaciones] ([IdClasificacion]),
    FOREIGN KEY ([idCliente]) REFERENCES [dbo].[tblClientes] ([IdCliente]),
    FOREIGN KEY ([IdDivisa]) REFERENCES [dbo].[tblDivisas] ([idDivisa]),
    FOREIGN KEY ([idLocalidadNegocio]) REFERENCES [dbo].[tblLocalidadesNegocio] ([IdLocalidadNegocio]),
    FOREIGN KEY ([idNegocio]) REFERENCES [dbo].[tblNegocios] ([IdNegocio]),
    FOREIGN KEY ([idPeriodo]) REFERENCES [dbo].[tblPeriodos] ([idPeriodo]),
    FOREIGN KEY ([IdTasaInteres]) REFERENCES [dbo].[tblTasasInteres] ([idTasaInteres]),
    FOREIGN KEY ([idTipoMora]) REFERENCES [dbo].[tblTiposMora] ([idTipoMora]),
    CONSTRAINT [fk_idPrestamoARenovar] FOREIGN KEY ([IdPrestamoARenovar]) REFERENCES [dbo].[tblPrestamos] ([IdPrestamo]),
    UNIQUE NONCLUSTERED ([idNegocio] ASC, [prestamoNumero] ASC)
);


	
