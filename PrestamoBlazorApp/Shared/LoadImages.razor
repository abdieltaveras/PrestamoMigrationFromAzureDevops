<h3>LoadImages</h3>
<div class="image-list col-md-5">
    <table class="table">
        <tbody>
            <tr>
                @{

                    int imageIndex = 0;
                    @foreach (var imageDataUrl in ListaImagenesURL)
                    {
                        var sendIndex = imageIndex;
                        <td width="50%">
                            <img src="@imageDataUrl" />
                            <ConfirmationDialog ButtonText="Quitar"
                                                objRef="sendIndex"
                                                OnOk="QuitarImagen"
                                                Title="Confirmar Quitar Foto"
                                                ConfirmationMessage="Realmente desea quitar la foto" />

                        </td>
                        imageIndex++;
                    }
                }
            </tr>
        </tbody>
    </table>

</div>
@code {
    [Inject]
    IJSRuntime JsRuntime { get; set; }

    int imagelist = 0;
    JsInteropUtils JsInteropUtils { get; set; } = new JsInteropUtils();

    IList<string> imageDataUrls = new List<string>();
    [Parameter]
    public IEnumerable<string> ListaImagenesURL { get; set; } = new List<string>();
    [Parameter]
    public string MensajeLimiteImagenes { get; set; } = string.Empty;
    [Parameter]
    public string Text { get; set; } = string.Empty;
    [Parameter]
    //public EventCallback<IList<string>> OnImageLoad { get; set; }
    public EventCallback<IList<string>> OnImageLoad { get; set; }
    [Parameter]
    public int ImageQty { get; set; }

    protected async override Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
        this.imageDataUrls = new List<string>();
    }
    async Task OnInputFileChange(InputFileChangeEventArgs e)
    {
        var imageFiles = e.GetMultipleFiles();
        if (imageFiles.Count >= ImageQty)
        {
            if (string.IsNullOrEmpty(MensajeLimiteImagenes))
            {
                MensajeLimiteImagenes = $"eligio {imageFiles.Count} imagenes, y solo se permiten {this.ImageQty}";
            }
            return;
        }
        var format = "image/png";
        foreach (var imageFile in imageFiles)
        {
            var resizedImageFile = await imageFile.RequestImageFileAsync(format, 100, 100);
            var buffer = new byte[resizedImageFile.Size];
            await resizedImageFile.OpenReadStream().ReadAsync(buffer);
            var imageDataUrl = $"data:{format};base64,{Convert.ToBase64String(buffer)}";
            imageDataUrls.Add(imageDataUrl);
        }
        await OnImageLoad.InvokeAsync(imageDataUrls);
    }




    void QuitarImagen(object ob)
    {
        int imageIndex = (int)ob;
        imageDataUrls.RemoveAt(imageIndex);
    }


}
